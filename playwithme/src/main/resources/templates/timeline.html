<!doctype html>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        xmlns:th="http://thymeleaf.org"
        layout:decorate="~{fragment/layout}"
>
<head>
        <meta charset="UTF-8">
        <title>Your Timeline</title>
</head>

<body layout:fragment="content">
<!-- ë²„íŠ¼ ë¶€íŠ¸ìŠ¤íŠ¸ë© -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
<!-- í°íŠ¸ì–´ì¸ ì•„ì´ì½˜ -->
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="/mypage/timeline/style.css" />

<section class="intro">
    <div class="container">
        <h1> TimeLine <i class="fa fa-history" aria-hidden="true"></i> </h1>

        <h5 th:if="${#lists.size(events)} != 0"> ê°„ë‹¨í•œ ë©”ëª¨ì™€ í•¨ê»˜ ë‹¤ë…€ì˜¨ ì´ë²¤íŠ¸ë¥¼ ì¶”ì–µí•´ë³´ì„¸ìš”!</h5>
        <h5 th:if="${#lists.size(events)} != 0"> (ë™í–‰ì´ ì™„ë£Œëœ ì´ë²¤íŠ¸ë“¤ë§Œ ë³´ì—¬ìš”ğŸ‘€)</h5>
        <h5 th:if="${#lists.size(events)} == 0"> ë‹¤ë…€ì˜¨ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤. PWMë¥¼ í†µí•´ ë‹¤ì–‘í•œ ì‚¬ëŒë“¤ê³¼ ë™í–‰í•´ë³´ì„¸ìš”!</h5>
    </div>
</section>

<section class="timeline">
    <ul>
        <li th:each="events, num : ${events}">
            <div>

                <!--ì´ë²¤íŠ¸ ë‚ ì§œ-->
                <span class="timeline-content-info-date">
                    [[${#strings.substring(events.date,0,10)}]]
                </span>

                <!-- ì´ë²¤íŠ¸ ì´ë¦„-->
                <h3>
                    [[${events.name}]]
                </h3>

                <!-- ì´ë²¤íŠ¸ ì¥ì†Œ-->
                <span class="timeline-content-info-title">
                    <!-- ì•„ì´ì½˜ -->
                    <i class="fa fa-certificate" aria-hidden="true"></i>
                    [[${events.location}]]
                </span>

                <!-- ë©”ëª¨ ì‘ì„±í¼-->
                <span th:each="timelines, num2 : ${timelines}">
                    <span th:if="${num.index}==${num2.index}">
                        <form onsubmit="spaceCheck(this); return false;"
                              th:if="${timelines.memo}==null"
                              th:action="@{|/mypage/timeline/memo/${timelines.id}|}" method="post"
                              th:object="${requestDto}">
                            <textarea th:field="*{memo}" id="new-memo" class="form-control" rows="3" placeholder="Write your own memo here!"></textarea>
                            <input type="submit" value="ë“±ë¡" class="btn btn-dark btn-sm">
                        </form>
                    </span>
                </span>

                <span th:each="timelines, num2 : ${timelines}">
                    <span th:if="${num.index}==${num2.index} and ${timelines.memo}!=null">
                        <span id="show-memo-box" th:classappend="${timelines.id}">
                            <!--ë©”ëª¨ ì¡°íšŒ-->
                            <span id="memo" th:text="${timelines.memo}" th:classappend="${timelines.id}"></span>
                            <!-- ë©”ëª¨ ìˆ˜ì • ë²„íŠ¼-->
                            <button id="btn-memo-update" class="btn btn-dark btn-sm" th:onclick="findIdToHide([[${timelines.id}]]); findIdToShow([[${num2.index}]]);" th:classappend="${timelines.id}"><i class="fa fa-pencil" aria-hidden="true"></i></button>
                            <!--ë©”ëª¨ ì‚­ì œ ë²„íŠ¼--> <!--TODO-->
                            <button id="btn-memo-delete" class="btn btn-dark btn-sm" th:onclick="confirmMsg([[${events.name}]],[[${timelines.id}]])" th:classappend="${timelines.id}"><i class="fa fa-times" aria-hidden="true"></i></button>
                        </span>
                        <!--ë©”ëª¨ ìˆ˜ì •í¼-->
                        <form id ="memo-update-form"
                              th:classappend="${num2.index}"
                              th:action="@{|/mypage/timeline/memo/modify/${timelines.id}|}" method="post">

                            <input type="hidden" id="togethersId"  th:value="${timelines.id}">
                            <textarea class="form-control" id="update-memo" rows="3" name="memo" th:text="${timelines.memo}"></textarea>

                            <input type="submit" value="ì €ì¥" class="btn btn-dark btn-sm">
                            <input type="button" value="ìˆ˜ì •ì·¨ì†Œ" onClick="window.location.reload()" class="btn btn-dark btn-sm">
                        </form>
                    </span>
                </span>

            </div>
        </li>
    </ul>
</section>
<script layout:fragment="script" type='text/javascript'>
    (function () {
  "use strict";

  // define variables
  var items = document.querySelectorAll(".timeline li");

  // check if an element is in viewport
  // http://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport
  function isElementInViewport(el) {
    var rect = el.getBoundingClientRect();
    return (
      rect.top >= 0 &&
      rect.left >= 0 &&
      rect.bottom <=
        (window.innerHeight || document.documentElement.clientHeight) &&
      rect.right <= (window.innerWidth || document.documentElement.clientWidth)
    );
  }

  function callbackFunc() {
    for (var i = 0; i < items.length; i++) {
      if (isElementInViewport(items[i])) {
        items[i].classList.add("in-view");
      }
    }
  }

  // listen for events
  window.addEventListener("load", callbackFunc);
  window.addEventListener("resize", callbackFunc);
  window.addEventListener("scroll", callbackFunc);
})();

// ë©”ëª¨ í¼ ì²´í¬
function spaceCheck(form){
const isSpace = form.querySelector('.form-control').value.trim();
    if (isSpace.length == 0) {
        alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
        }
        form.submit();
}

// ìˆ˜ì • ë²„íŠ¼ í´ë¦­ì‹œ ê¸°ì¡´ ë©”ëª¨ì™€ ìˆ˜ì •ë²„íŠ¼, ì‚­ì œë²„íŠ¼ ì•ˆë³´ì´ë„ë¡
function findIdToHide(id){
    const find = document.getElementsByClassName(id);
    for(var i = 0; i < find.length; i++){
        //console.log('ìˆ¨ê¹€ì™„ë£Œ')
        find[i].style.display ='none';
    }
}

// ìˆ˜ì • ë²„íŠ¼ í´ë¦­ì‹œ ìˆ˜ì •í¼ ë‚˜íƒ€ë„ë¡
function findIdToShow(id){
    const find = document.getElementsByClassName(id);
    for(var i = 0; i < find.length; i++){
        find[i].style.display ='block';
    }
}

// ë©”ëª¨ ì‚­ì œ ì „ confirm
function confirmMsg(name,id){
    if ( !confirm(name + " ë©”ëª¨ë¥¼ ì‚­ì œí• ê¹Œìš”?") ) {
        return false;
        }
    window.location.href = "/mypage/timeline/memo/delete/"+id;
}
</script>
</body>
</html>
